<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta content="width=device-width, initial-scale=1" name="viewport" />
	
	<title>EPL 2013</title>

	<link id="styles" rel="stylesheet" href="assets/css/epl.css">

	<meta name="title" content="">
	<meta name="description" content="">
	<link rel="" href=""> 

	<script src="../../base/js/dev.js"></script>

	<script src="../../base/js/lib/d3.js"></script>

<!--
	<meta name="twitter:card" content="summary">
	<meta name="twitter:url" content="">
	<meta name="twitter:title" content="">
	<meta name="twitter:description" content="">
	<meta name="twitter:image" content=""> -->
</head>

<body></body>

</html>

<script>
// Div = League Division
// Date = Match Date (dd/mm/yy)
// HomeTeam = Home Team
// AwayTeam = Away Team
// FTHG = Full Time Home Team Goals
// FTAG = Full Time Away Team Goals
// FTR = Full Time Result (H=Home Win, D=Draw, A=Away Win)
// HTHG = Half Time Home Team Goals
// HTAG = Half Time Away Team Goals
// HTR = Half Time Result (H=Home Win, D=Draw, A=Away Win)

var w = 500,
    h = 400;

var svg = d3.select("body").append("svg")
                           .style('background','#eee').attr("width", w).attr("height", h); 	

d3.csv('2012-13.csv', loadCSV);

function loadCSV(data) {
	window.d = data;
	window.mu = [];
	window.teams = {};
	window.total = {};

	data.forEach(function(match) {
		
		function appendResult(t){
			if (!total[t]) total[t]=0;
			total[t] += points(match, t);
			if (! teams[t])	teams[t] = [];
			teams[t].push({
				date: new Date( date(match) ),
				points: total[t]
			})
		}

		appendResult(match.HomeTeam)
		appendResult(match.AwayTeam)
		// match.prototype = Match;
	});
	for (t in teams) {
		dataReady(teams[t])
	}
}

function dataReady(data) {
	var max = 80; //d3.max(data, function(d){ return d.points });

	var x = d3.time.scale().domain([new Date(2012, 7, 16), new Date(2013, 3, 31)]).range([0, w]);
	var y  = d3.scale.linear().domain([0, max]).range([h, 0]);

	var line = d3.svg.line()
  	  .x(function(d) { return x(d.date); })
    	.y(function(d) { return y(d.points); })
      .interpolate("basis");

  svg.append("path")
      .datum(data)
      .attr("class", "line")
      .attr('fill', 'none')
      .attr('stroke', 'black') // stroke-width: 1.5px;
      .attr("d", line);
// ddd.exit().remove();
}




// match prototype...

function date(match) {
	var date = match.Date.split('/').reverse();
	date[0] = '20' + date[0];
	return date.join('-');
}

function home(match, team) {
	return (match.HomeTeam == team)
}

function away(match, team) {
	return (match.AwayTeam == team)
}

function played(match, team) {
	return home(match, team) || away(match, team)
}

function scored(match, team) {
	if (home(match, team)) return match.FTHG;
	if (away(match, team)) return match.FTAG;
}

function opponent(match, team) {
	if (home(match, team)) return match.AwayTeam;
	if (away(match, team)) return match.HomeTeam;	
}

function conceded(match, team) {
	if (home(match, team)) return match.FTAG;
	if (away(match, team)) return match.FTHG;	
}

function difference(match, team) {
	return scored(match, team) - conceded(match, team)
}

function points(match, team) {
	if (played(match, team)) {
		var diff = difference(match, team);
		if (diff > 0) return 3;
		else if (diff < 0) return 0;
		else return 1;
	}
}

</script>