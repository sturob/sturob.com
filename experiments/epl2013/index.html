<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta content="width=device-width, initial-scale=1" name="viewport" />
	
	<title>EPL 2013</title>

	<link id="styles" rel="stylesheet" href="assets/css/epl.css">

	<meta name="title" content="">
	<meta name="description" content="">
	<link rel="" href=""> 

	<script src="../../base/js/dev.js"></script>

	<script src="../../base/js/lib/d3.js"></script>

<!--
	<meta name="twitter:card" content="summary">
	<meta name="twitter:url" content="">
	<meta name="twitter:title" content="">
	<meta name="twitter:description" content="">
	<meta name="twitter:image" content=""> -->
</head>

<body></body>

</html>

<script>
// Div = League Division
// Date = Match Date (dd/mm/yy)
// HomeTeam = Home Team
// AwayTeam = Away Team
// FTHG = Full Time Home Team Goals
// FTAG = Full Time Away Team Goals
// FTR = Full Time Result (H=Home Win, D=Draw, A=Away Win)
// HTHG = Half Time Home Team Goals
// HTAG = Half Time Away Team Goals
// HTR = Half Time Result (H=Home Win, D=Draw, A=Away Win)

var w = 500,
    h = 300;

var svg = d3.select("body").append("svg")
                           .style('background','#eee').attr("width", w).attr("height", h); 	

d3.csv('2012-13.csv', loadCSV)

function loadCSV(data) {
	window.d = data;
	window.mu = [];
	var total = 0;;
	data.forEach(function(match) {
		// match.prototype = Match;
		if (played(match, 'Man United')) {
			total += points(match, 'Man United');
			mu.push({
				date: date(match),
				points: total
			})
		}
	});
	dataReady(mu)
}


function dataReady(data) {
	var max = d3.max(data, function(d){ return d.points });

	var viz = svg.selectAll("rect")
               .data(data, function(d, i) { return i });

	var x = d3.time.scale().domain([new Date(2012, 9, 1), new Date(2013, 3, 31)]).range([0, w]);
	var y  = d3.scale.linear().domain([0, max]).range([h, 0]);
	var ch = d3.scale.linear().domain([0, max]).range([0, h]);

	viz.enter()
    .append("rect")
    .attr("x", function(d,i){ return x(new Date(d.date)) })
    .attr("width", 10)
    .attr("height", function (d, i) {
    	return ch(d.points)
    })
    .attr("y", function(d, i) {
    	return y(d.points)
   	});

// ddd.exit().remove();

}




// match prototype...

function date(match) {
	var date = match.Date.split('/').reverse();
	date[0] = '20' + date[0];
	return date.join('-');
}

function home(match, team) {
	return (match.HomeTeam == team)
}

function away(match, team) {
	return (match.AwayTeam == team)
}

function played(match, team) {
	return home(match, team) || away(match, team)
}

function scored(match, team) {
	if (home(match, team)) return match.FTHG;
	if (away(match, team)) return match.FTAG;
}

function opponent(match, team) {
	if (home(match, team)) return match.AwayTeam;
	if (away(match, team)) return match.HomeTeam;	
}

function conceded(match, team) {
	if (home(match, team)) return match.FTAG;
	if (away(match, team)) return match.FTHG;	
}

function difference(match, team) {
	return scored(match, team) - conceded(match, team)
}

function points(match, team) {
	if (played(match, team)) {
		var diff = difference(match, team);
		if (diff > 0) return 3;
		else if (diff < 0) return 0;
		else return 1;
	}
}

</script>